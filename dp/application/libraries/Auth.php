<?php if ( ! defined('BASEPATH')) exit('No direct script access allowed'); class Auth {	protected $CI;		function __construct () {		$this->CI =& get_instance();	}		function login($email, $password) {		$this->CI->load->model('user_model');		$result = $this->CI->user_model->verify_and_get_user($email, $password);				if ($result['is_true'] == TRUE) { // if the email and the password are valid and they match			foreach ($result['query_result'] as $qr);						$session_data =	array(							'user_id' => $qr->user_id,							'first_name' => $qr->first_name,							/*'last_name' => $qr->last_name,                                                        'email' => $qr->email,                                                        'phone' => $qr->phone,*/							'user_level' => $qr->user_level,							'is_logged_in' => TRUE							);			$this->CI->session->set_userdata($session_data);						//$data['message'] = $result['message'];			$data['is_true'] = $result['is_true'];			$data['is_admin'] = ($qr->user_level == $this->CI->config->item('admin_level') ? TRUE : FALSE);			return $data;		} else { // if the email and the password are not valid or they don't match			$data['message'] = $result['message'];			$data['is_true'] = $result['is_true'];			return $data;		}	}	function is_logged_in() {		$is_logged_in = $this->CI->session->userdata('is_logged_in');		if (!isset($is_logged_in) || $is_logged_in != TRUE ) {			$this->CI->session->set_flashdata('message', 'Please, log in, first!');			redirect('user/login', 'location');		}	}		function is_admin() {		$admin_level = $this->CI->config->item('admin_level');		$user_level = $this->CI->session->userdata('user_level');			if (!isset($user_level) || $user_level != $admin_level) {                // if the user is not an admin, redirect him to the homepage			redirect('brand', 'location');		}	}		function logout() {            // unset just the part of the session that describes the user            // instead of destroy it - which would also destroy the cart            $session_data =	array(					'user_id' => '',					'first_name' => '',					'user_level' => '',					'is_logged_in' => FALSE                                       );           $this->CI->session->unset_userdata($session_data);	}}/* End of custom library, Auth.php */